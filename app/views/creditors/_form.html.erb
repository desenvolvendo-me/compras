<%= f.input :person, :disabled => f.object.persisted?  %>

<%= f.input :personable_type, :as => :hidden %>

<p>
  <%= link_to_modal_info 'creditor_person', f.object.person %>
</p>

<div id="creditor-tabs">
</div>

<%= mustache 'individual-template' do %>
  <%= render 'individuals', :f => f %>
<% end %>

<%= mustache 'company-template' do %>
  <%= render 'companies', :f => f %>
<% end %>

<%= mustache 'special-entry-template' do %>
  <%= render 'special_entries', :f => f %>
<% end %>

<script>
  $('#creditor_person_id').change(function (event, people) {
    if (people) {
      $('#creditor_personable_type').val(people.personable_type);
    } else {
      $('#creditor_personable_type').val('');
    }
  });

  function showOnlyIndividualFields(){
    $('#creditor_company_size').parent().hide();
    $('#creditor_choose_simple').parent().hide();
    $('#creditor_main_cnae').parent().hide();
  };

  function showOnlyCompanyFields(){
    $('#creditor_occupation_classification').parent().hide();
    $('#creditor_municipal_public_administration').parent().parent().hide();
    $('#creditor_autonomous').parent().hide();
    $('#creditor_social_identification_number').parent().hide();
    $('#creditor_contract_start_date').parent().hide();

  };

  function renderPartial(){
    switch ($('#creditor_personable_type').val()){
      case 'Individual':
        $("#creditor-tabs").html($("#individual-template").mustache());
        showOnlyIndividualFields();
        break;
      case 'Company':
        $("#creditor-tabs").html($("#company-template").mustache());
        showOnlyCompanyFields();
        break;
      case 'SpecialEntry':
        $("#creditor-tabs").html($("#special-entry-template").mustache());
        break;
    }
  };

  $("#creditor_person_id").change(function () {
    renderPartial();
    loadTabs();
  });

  renderPartial();
</script>
