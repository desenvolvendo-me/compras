<div id="item-tab">
  <%= f.error :items %>

  <div class="yui3-g">
    <div class="yui3-u-1-3">
      <%= f.input :total_items_value, :disabled => true,
        :input_html => { :value => number_with_precision(f.object.total_items_value) } %>
    </div>
  </div>

  <div class="nested-fields">
    <div class="yui3-g">
      <div class="yui3-u-3-5">
        <%= f.input :material, :as => :auto_complete, :fake => true, :required => true,
          'data-hidden-field-class' => 'unique' %>
      </div>

      <div class="yui3-u-1-8">
        <%= f.input :reference_unit, :as => :fake, :disabled => true %>
      </div>
    </div>

    <div class="yui3-g">
      <div class="yui3-u-1-4">
        <%= f.input :brand, :as => :fake %>
      </div>

      <div class="yui3-u-1-6">
        <%= f.input :quantity, :as => :fake, :required => true,
          :input_html => { 'data-decimal' => true, :value => '0,00', 'data-precision' => 2, :maxlength => 15, :class => 'numeric' } %>
      </div>

      <div class="yui3-u-1-6">
        <%= f.input :unit_price, :as => :fake,
          :input_html => { 'data-decimal' => true, :value => '0,00', 'data-precision' => 2, :maxlength => 15, :class => 'numeric' } %>
      </div>

      <div class="yui3-u-1-6">
        <%= f.input :estimated_total_price, :as => :fake, :disabled => true,
          :input_html => { 'data-decimal' => true, :value => '0,00', 'data-precision' => 2, :maxlength => 15, :class => 'numeric' } %>
      </div>

      <div class="yui3-u-1-6">
         <%= button_tag 'Adicionar', :class => 'button nested-add-record field-without-label',
           'data-template' => 'purchase_solicitation_items_template',
           'data-records' => 'items-records',
           'data-disabled' => f.object.decorator.is_annulled_message %>
      </div>
    </div>
  </div>

  <table id="items-records" class="records">
    <thead>
      <tr>
        <th><%= PurchaseSolicitationItem.human_attribute_name :material %></th>
        <th><%= PurchaseSolicitationItem.human_attribute_name :reference_unit %></th>
        <th><%= PurchaseSolicitationItem.human_attribute_name :brand %></th>
        <th><%= PurchaseSolicitationItem.human_attribute_name :quantity %></th>
        <th><%= PurchaseSolicitationItem.human_attribute_name :unit_price %></th>
        <th><%= PurchaseSolicitationItem.human_attribute_name :estimated_total_price %></th>
        <th></th>
      </tr>
    </thead>

    <tbody>
      <%= f.association :items, :collection => localized(f.object.items) do |p| %>
        <%= render 'purchase_solicitation_items/list_form',
            :material => p.object.material,
            :material_id => p.object.material_id,
            :reference_unit => p.object.reference_unit,
            :brand => p.object.brand,
            :quantity => number_with_precision(p.object.quantity),
            :unit_price => number_with_precision(p.object.unit_price),
            :estimated_total_price => number_with_precision(p.object.estimated_total_price),
            :data_disabled => f.object.decorator.is_annulled_message,
            :f => p %>
      <% end %>
    </tbody>
  </table>

  <%= mustache "purchase_solicitation_items_template" do %>
    <%= f.association :items_attributes, :collection => f.object.items.build, :index => '{{uuid}}' do |p| %>
      <%= render 'purchase_solicitation_items/list_form',
                 :material => '{{material}}',
                 :material_id => '{{material_id}}',
                 :reference_unit => '{{reference_unit}}',
                 :brand =>'{{brand}}',
                 :quantity => '{{quantity}}',
                 :unit_price => '{{unit_price}}',
                 :estimated_total_price => '{{estimated_total_price}}',
                 :data_disabled => nil,
                 :f => p %>
    <% end %>
  <% end %>
</div>
