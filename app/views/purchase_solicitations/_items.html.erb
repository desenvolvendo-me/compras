<div id="item-tab">
  <div class="yui3-g">
    <div class="yui3-u-1-3">
      <%= f.input :total_items_value, :disabled => true, :input_html => { :value => number_with_precision(f.object.total_items_value) } %>
    </div>
  </div>

  <%= f.error :items %>

  <p>
    <input type="button" class="button affirmative add-item"<%= data_disabled_attribute(f.object.decorator.is_annulled_message) %> value="Adicionar Item">
  </p>

  <div id="items">
    <%= f.association :items, :collection => localized(f.object.items) do |p| %>
      <%= render 'purchase_solicitation_items/form', :f => p, :data_disabled => f.object.decorator.is_annulled_message %>
    <% end %>
  </div>
</div>

<%= mustache 'items-template' do %>
  <%= f.association :items_attributes, :collection => f.object.items.build, :index => '{{uuid_item}}' do |p| %>
    <%= render 'purchase_solicitation_items/form', :f => p, :data_disabled => nil %>
  <% end %>
<% end %>

<script>
  $("#items-template").nestedForm({
    add: '.add-item',
    remove: '.remove-item',
    target: '#items',
    uuid: 'uuid_item',
    fieldsWrapper: '.item',
    appendItem: false
  });

  <% if f.object.annulled? %>
    $('form.purchase_solicitation [data-disabled]').on('click', function(event){
      event.stopImmediatePropagation();
      return false;
    });
  <% end %>

  $('form').on('change', '.budget-allocation', function (event, budgetAllocation) {
    if (budgetAllocation) {
      var inputs = $(this).closest('div.nested').find(':input');
    }
  });
</script>
