<div id="items">
  <p>
    <input type="button" class="button affirmative add-purchase-solicitation-item" value="Adicionar Item">
  </p>

  <%= f.association :items, :collection => localized(f.object.items) do |p| %>
    <%= render 'purchase_solicitation_items/form', :f => p %>
  <% end %>
</div>

<%= mustache 'purchase-solicitation-items-template' do %>
  <%= f.association :items_attributes, :collection => f.object.items.build, :index => '{{uuid_purchase_solicitation_item}}' do |p| %>
    <%= render 'purchase_solicitation_items/form', :f => p %>
  <% end %>
<% end %>

<script>
  $("#purchase-solicitation-items-template").nestedForm({
    add: '.add-purchase-solicitation-item',
    remove: '.remove-purchase-solicitation-item',
    target: '#items',
    uuid: 'uuid_purchase_solicitation_item'
  });

  $(".material").live('change', function (event, data) {
    if (data){
      var record = data.record,
          inputs = $(this).closest('fieldset').find(':input');
      $(inputs[2]).val(record.data("reference-unit"));
    }
  });
</script>
