<div class="tabs">
  <ul>
    <li><a href="#general">Principal</a></li>
    <li><a href="#members">Membros</a></li>
    <li><a href="#advice">Parecer</a></li>
  </ul>

  <div id="general">
    <%= render 'general', :f => f %>
  </div>

  <div id="members">
    <%= render 'members', :f => f %>
  </div>

  <div id="advice">
    <%= render 'advice', :f => f %>
  </div>
</div>

<script>
  function cleanExistingMembers() {
    $('.member.inherited').each(function() {
      $(this).find('input.destroy').attr('value', 'true');
      $(this).hide();
    });
  }

  function createMembersFromLicitationCommission(members) {
    cleanExistingMembers();

    var template = $('#licitation-commission-inherited-member-template'),
        target = $('#licitation-commission-members'),
        member;

    $(members).each(function() {
      member = template.mustache({ uuid_member: _.uniqueId('fresh-'),
                                   licitation_commission_member_id: this.id,
                                   individual_name: this.individual_name,
                                   role_humanize: this.role_humanize,
                                   role_nature_humanize: this.role_nature_humanize,
                                   registration: this.registration,
                                   cpf: this.cpf });
      target.prepend(member);
    });
  }

  $('#judgment_commission_advice_licitation_commission_id').change(function (event, advice_licitation_commission) {
    if (advice_licitation_commission){
      $('#judgment_commission_advice_licitation_commission_president_name').val(advice_licitation_commission.president_name);
      createMembersFromLicitationCommission(advice_licitation_commission.members);
    } else {
      $('#judgment_commission_advice_licitation_commission_president_name').val('');
      cleanExistingMembers();
    }
  });

  $(".judgment_commission_advice").delegate('.individual', 'change', function (event, individual) {
    if (individual){
      $(this).closest('.nested').find('.cpf').val(individual.cpf);
    } else {
      $(this).closest('.nested').find('.cpf').val('');
    }
  });
</script>
