<div class="tabs" id="judment_commission_advices">
  <ul>
    <li>
      <a href="#main">Principal</a>
    </li>

    <li>
      <a href="#members">Membros</a>
    </li>

    <li class='advice'>
      <a href="#advice">Parecer</a>
    </li>
  </ul>

  <div id="main">
    <%= render 'judgment_commission_advices/main', :f => f %>
  </div>

  <div id="members">
    <%= render 'judgment_commission_advices/members', :f => f %>
  </div>

  <div id="advice">
    <%= render 'judgment_commission_advices/advice', :f => f %>
  </div>
</div>

<script>
  function cleanExistingMembers() {
    $('.member.inherited').each(function() {
      $(this).find('input.destroy').attr('value', 'true');
      $(this).hide();
    });
  }

  function createMembersFromLicitationCommission(members) {
    cleanExistingMembers();

    var template = $('#licitation-commission-inherited-member-template'),
        target = $('#licitation-commission-members'),
        member;

    $(members).each(function() {
      member = template.mustache({ uuid_member: _.uniqueId('fresh-'),
                                   licitation_commission_member_id: this.id,
                                   individual_name: this.individual_name,
                                   role_humanize: this.role_humanize,
                                   role_nature_humanize: this.role_nature_humanize,
                                   registration: this.registration,
                                   cpf: this.cpf });
      target.prepend(member);
    });
  }

  $("[name$='[licitation_commission_id]']").change(function (event, adviceLicitationCommission) {
    debugger
    if (adviceLicitationCommission){
      $("[name$='[licitation_commission_president_name]']").val(adviceLicitationCommission.president_name);
      createMembersFromLicitationCommission(adviceLicitationCommission.members);
    } else {
      $("[name$='[licitation_commission_president_name]']").val('');
      cleanExistingMembers();
    }
  });

  $("#judment_commission_advices").on('change', '.individual', function (event, individual) {
    if (individual){
      $(this).closest('.nested').find('.cpf').val(individual.cpf);
    } else {
      $(this).closest('.nested').find('.cpf').val('');
    }
  });
  <% if f.object.licitation_process.direct_purchase? %>
    $('.advice').addClass('hidden');
  <% else %>
    $('.advice').removeClass('hidden');
    $("[name$='[judgment_start_date]']").requiredField(true);
    $("[name$='[judgment_start_time]']").requiredField(true);
    $("[name$='[judgment_end_date]']").requiredField(true);
    $("[name$='[judgment_end_time]']").requiredField(true);
    $("[name$='[companies_minutes]']").requiredField(true);
    $("[name$='[companies_documentation_minutes]']").requiredField(true);
    $("[name$='[justification_minutes]']").requiredField(true);
    $("[name$='[judgment_minutes]']").requiredField(true);
  <% end %>
</script>
