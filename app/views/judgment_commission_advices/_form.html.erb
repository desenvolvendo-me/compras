<div class="tabs" id="judment_commission_advices">
  <ul>
    <li>
      <a href="#main">Principal</a>
    </li>

    <li>
      <a href="#members">Membros</a>
    </li>

    <li class='advice'>
      <a href="#advice">Parecer</a>
    </li>
  </ul>

  <div id="main">
    <%= render 'main', :f => f %>
  </div>

  <div id="members">
    <%= render 'members', :f => f %>
  </div>

  <div id="advice">
    <%= render 'advice', :f => f %>
  </div>
</div>

<script>
  function cleanExistingMembers() {
    $('.member.inherited').each(function() {
      $(this).find('input.destroy').attr('value', 'true');
      $(this).hide();
    });
  }

  function createMembersFromLicitationCommission(members) {
    cleanExistingMembers();

    var template = $('#licitation-commission-inherited-member-template'),
        target = $('#licitation-commission-members'),
        member;

    $(members).each(function() {
      member = template.mustache({ uuid_member: _.uniqueId('fresh-'),
                                   licitation_commission_member_id: this.id,
                                   individual_name: this.individual_name,
                                   role_humanize: this.role_humanize,
                                   role_nature_humanize: this.role_nature_humanize,
                                   registration: this.registration,
                                   cpf: this.cpf });
      target.prepend(member);
    });
  }

  $('#judgment_commission_advice_licitation_commission_id').change(function (event, adviceLicitationCommission) {
    if (adviceLicitationCommission){
      $('#judgment_commission_advice_licitation_commission_president_name').val(adviceLicitationCommission.president_name);
      createMembersFromLicitationCommission(adviceLicitationCommission.members);
    } else {
      $('#judgment_commission_advice_licitation_commission_president_name').val('');
      cleanExistingMembers();
    }
  });

  $(".judgment_commission_advice").on('change', '.individual', function (event, individual) {
    if (individual){
      $(this).closest('.nested').find('.cpf').val(individual.cpf);
    } else {
      $(this).closest('.nested').find('.cpf').val('');
    }
  });
  <% if f.object.licitation_process.direct_purchase? %>
    $('.advice').addClass('hidden');
  <% else %>
    $('.advice').removeClass('hidden');
    $('#judgment_commission_advice_judgment_start_date').requiredField(true);
    $('#judgment_commission_advice_judgment_start_time').requiredField(true);
    $('#judgment_commission_advice_judgment_end_date').requiredField(true);
    $('#judgment_commission_advice_judgment_end_time').requiredField(true);
    $('#judgment_commission_advice_judgment_start_time').requiredField(true);
    $('#judgment_commission_advice_companies_minutes').requiredField(true);
    $('#judgment_commission_advice_companies_documentation_minutes').requiredField(true);
    $('#judgment_commission_advice_justification_minutes').requiredField(true);
    $('#judgment_commission_advice_judgment_minutes').requiredField(true);
  <% end %>
</script>
