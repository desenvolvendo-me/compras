<%= render "reports/header", :report_name => "Quadro Comparativo de Preços da Coleta de preço #{resource}" %>

<h3>Apuração: <%= resource.type_of_calculation_humanize %></h3>

<% resource.decorator.all_price_collection_classifications_groupped.each do |proposal, classifications| %>
  <h3>Fornecedor: <%= proposal.creditor %></h3>

  <table class="records">
    <thead>
      <% if resource.lowest_price_by_lot? %>
        <th><%= PriceCollectionItem.human_attribute_name :lot %></th>
        <th class="right"><%= PriceCollectionClassification.human_attribute_name :total_value %></th>
        <th><%= PriceCollectionClassification.human_attribute_name :winner %></th>
      <% else %>
        <th><%= Material.human_attribute_name :description %></th>
        <th><%= Material.human_attribute_name :reference_unit %></th>
        <th><%= PriceCollectionItem.human_attribute_name :brand %></th>
        <th><%= PriceCollectionItem.human_attribute_name :quantity %></th>
        <th><%= PriceCollectionProposalItem.human_attribute_name :unit_price %></th>
        <th><%= PriceCollectionClassification.human_attribute_name :total_value %></th>
        <th><%= PriceCollectionClassification.human_attribute_name :winner %></th>
      <% end %>
    </thead>

    <tbody>
      <%= render resource.type_of_calculation, resource: resource, proposal: proposal,
        classifications: classifications %>
    </tbody>
  </table>
<% end %>
