<div class="row">
  <div class="col">
    <%= button_tag 'Adicionar Habilitação', type: :button,
                   class: "button", id: "add-proposal" %>

    <%= button_tag 'Cancelar', type: :button,
                   class: "button", id: "cancel-proposal" %>
  </div>
</div>

<div id="proposal-fields"></div>


<table id="proposals-records" class="records">
  <thead>
  <tr>
    <% PriceCollectionProposal.decorator.header_attributes.each do |field| %>
      <th><%= PriceCollectionProposal.human_attribute_name field %></th>
    <% end %>
    <th>Status</th>
    <th></th>
    <th></th>
  </tr>
  </thead>
  <tbody>
  <% f.object.price_collection_proposals.each do |resource| %>
    <tr id="<%= dom_id resource %>">
      <% PriceCollectionProposal.decorator.header_attributes.each do |field| %>
        <td>
            <%= formatted_attribute(resource.decorator, field) %>
        </td>
      <% end %>
      <td><%= resource.decorator.won_lots f.object, resource%></td>
      <td><%= link_to 'Visualizar', '#', class: 'edit-proposal', 'data-url': edit_proposal_price_collection_path(f.object.id, price_collection_proposal_id: resource.id) %></td>
      <td><%= link_to 'Remover', '#'%></td>
    </tr>
  <% end %>
  </tbody>
</table>
<%#raise %>

<%= mustache 'proposals-template' do %>
  <%= f.simple_fields_for :price_collection_proposals, generate_proposal_items(f.object) do |r| %>
    <%= render 'price_collection_proposals/form', :f => r %>
  <% end %>
<% end %>



<script type="text/javascript" charset="utf-8">
  $("#cancel-proposal").click(function(){
    $("#proposals-records, #add-proposal").show();
    $(this).hide();
    $("#proposal-fields").html('');
  });

  $(function(){
    $("#add-proposal").click(function() {
      $('#proposal-fields').append($('#proposals-template').mustache());
      showProprosal();
    });

    $(".edit-proposal").click(function() {
      var url = $(this).data('url');

      $.get(url, function (data) {
        $("#proposal-fields").html($(data).html());
       showProprosal();
      })
    });

    function showProprosal(){
      $(".tabs").tabs();
      $("#proposals-records, #add-proposal").hide();
      $("#cancel-proposal").show();
    }
  })
</script>

<style>
  #cancel-proposal{
    display: none;
    float: right;
  }
</style>