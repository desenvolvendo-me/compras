<div id="supply_order_invoices">

  <div class="nested-fields add-margin-bottom">
    <%= f.association :invoices_attributes, :collection => Invoice.new do |p| %>
      <% p.object_name = "invoice" %>
      <%= p.input :id, as: :hidden %>

      <div class="yui3-g">
        <div class="yui3-u-1-4">
          <%= p.input :number  %>
        </div>
        <div class="yui3-u-1-4">
          <%= p.input :date %>
        </div>
        <div class="yui3-u-1-4">
          <%= p.input :release_date %>
        </div>
        <div class="yui3-u-1-4">
          <%= p.input :value, :input_html =>{ disabled: true, id:"total-invoice-value" } %>
        </div>
      </div>

      <div class="d-flex" style="justify-content: space-between">
        <div>
          <h3>Selecione os Itens da Nota </h3>
        </div>
        <div style="margin-top: 18px">
          (*O Sistema permite modificar Quantidade Fornecida para menor se necess√°rio)
        </div>
      </div>


      <table id="invoice-items-records" class="records ignore-data">
        <thead>
        <tr>
          <th><%= Material.human_attribute_name :code %></th>
          <th><%= SupplyOrderItem.human_attribute_name :material %></th>
          <th width="10%"><%= 'Quantidade Pedida' %></th>
          <th width="10%">Quantidade Consumida</th>
          <th width="10%">Quantidade Nota</th>
          <th width="10%">Valor</th>
        </tr>
        </thead>
        <tbody>
        <% f.object.items.each do |item| %>
          <%= simple_fields_for :supply_order_item_invoices, :collection => SupplyOrderItemInvoice.new do |r| %>
            <% r.object_name = "invoice_items" %>
            <%= render 'invoice_items', f: r, item: item %>
          <% end %>
        <% end %>
        </tbody>
      </table>

      <div class="yui3-u-1-6">
        <%= button_tag 'Adicionar', type: :button,
                       'data-template' => 'supply_order_invoices_template',
                       'data-records' => 'invoices-records',
                       'data-disabled' => not_updateable_message,
                       'data-ignored' => '.ignore-data',
                       :id => "supply_order_invoices_adicionar",
                       :class => 'button add-nested-record field-without-label' %>
      </div>

    <% end %>
  </div>

  <%= f.error :invoices %>

  <table id="invoices-records" class="records">
    <thead>
    <tr>
      <th><%= Invoice.human_attribute_name :number %></th>
      <th><%= Invoice.human_attribute_name :date %></th>
      <th><%= Invoice.human_attribute_name :release_date %></th>
      <th><%= Invoice.human_attribute_name :value %></th>
      <th></th>
      <th></th>
    </tr>
    </thead>
    <tbody>
    <%= f.association :invoices, :collection => localized(f.object.invoices) do |p| %>
      <%= render 'supply_order_invoices/form',
                 id: p.object.id,
                 number: p.object.number,
                 date: p.object.date,
                 release_date: p.object.release_date,
                 value: p.object.value,
                 items: p.object.supply_order_item_invoices,
                 f: p %>
    <% end %>
    </tbody>
  </table>
  <%= mustache "supply_order_invoices_template" do %>
    <%= f.association :invoices_attributes, :collection => f.object.invoices.build, :index => '{{uuid}}' do |p| %>
      <%= render 'supply_order_invoices/form',
                 id: '{{id}}',
                 number: '{{number}}',
                 date: '{{date}}',
                 release_date: '{{release_date}}',
                 value: '{{value}}',
                 items: nil,
                 f: p %>
    <% end %>
  <% end %>
</div>

