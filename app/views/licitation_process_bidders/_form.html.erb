<div class="yui3-g">
  <div class="yui3-u-1-3">
    <%= f.input :licitation_process, :disabled => true %>
  </div>

  <div class="yui3-u-1-3">
    <%= f.input :licitation_process_process_date, :disabled => true, :input_html => { :value => f.object.presenter.process_date } %>
  </div>

  <div class="yui3-u-1-3">
    <%= f.input :administrative_process, :disabled => true %>
  </div>

  <div class="yui3-u-1">
    <%= f.input :provider %>
  </div>

  <div class="yui3-u-1">
    <%= f.input :status, :disabled => true %>
  </div>

  <% if f.object.administrative_process_invited? %>
    <div class="yui3-u-1-4">
      <%= f.input :invited %>
    </div>

    <div class="yui3-u-1-4">
      <%= f.input :protocol  %>
    </div>

    <div class="yui3-u-1-4">
      <%= f.input :protocol_date %>
    </div>

    <div class="yui3-u-1-4">
      <%= f.input :receipt_date %>
    </div>
  <% end %>
</div>

<div class="tabs">
  <ul>
    <li><a href="#documents">Documentos</a></li>
    <li><a href="#proposal">Propostas</a></li>
  </ul>

  <div id="documents">
    <%= render 'documents', :f => f %>
  </div>

  <div id="proposal">
    <%= render 'proposal', :f => f %>
  </div>
</div>

<script>
  $('.tabs').tabs({
    create: function () {
      var tabWithError = $('.ui-tabs-panel:has(.error)', this).attr('id');

      if (tabWithError) {
        $(this).tabs('select', tabWithError);
      }
    }
  });

  function toggleEnabledDisabledFields() {
    if($('#licitation_process_bidder_invited').is(':checked')) {
      $('#licitation_process_bidder_protocol, #licitation_process_bidder_protocol_date, #licitation_process_bidder_receipt_date').attr('disabled', false);
     } else {
       $('#licitation_process_bidder_protocol, #licitation_process_bidder_protocol_date, #licitation_process_bidder_receipt_date').attr('disabled', true);
     }
   }

   function toggleRequiredFields() {
     if($('#licitation_process_bidder_invited').is(':checked')) {
       $('label[for|="licitation_process_bidder_protocol"], label[for|="licitation_process_bidder_protocol_date"], label[for|="licitation_process_bidder_receipt_date"]').append('<abbr title="obrigatÃ³rio">*</abbr>');
     } else {
       removeDuplicateRequiredLabels();
     }
   }

   function removeValuesFromDisabledFields() {
     if(!$('#licitation_process_bidder_invited').is(':checked')) {
       $('#licitation_process_bidder_protocol, #licitation_process_bidder_protocol_date, #licitation_process_bidder_receipt_date').val('');
     }
   }

   function removeDuplicateRequiredLabels(){
     $('label[for|="licitation_process_bidder_protocol"] abbr, label[for|="licitation_process_bidder_protocol_date"] abbr, label[for|="licitation_process_bidder_receipt_date"] abbr').remove();
   }

  $('#licitation_process_bidder_invited').click(function() {
    toggleEnabledDisabledFields();
    removeValuesFromDisabledFields();
    toggleRequiredFields();
  });

  removeDuplicateRequiredLabels();
  toggleEnabledDisabledFields();
  toggleRequiredFields();
</script>
