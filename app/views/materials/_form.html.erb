<%= f.input :materials_group, :as => :modal, :hidden_field => :materials_group_id %>
<%= f.input :materials_class, :disabled => f.object.materials_group.blank? %>

<% if f.object.persisted? %>
  <%= f.input :code, :disabled => true %>
<% end %>

<%= f.input :description %>
<%= f.input :detailed_description %>

<div class="yui3-g">
  <div class="yui3-u-1-2">
    <%= f.input :unit_price, :disabled => true %>
  </div>

  <div class="yui3-u-1-2">
    <%= f.input :minimum_stock_balance %>
  </div>

  <div class="yui3-u-1-2">
    <%= f.input :stock_balance, :disabled => true %>
  </div>

  <div class="yui3-u-1-2">
    <%= f.input :cash_balance, :disabled => true %>
  </div>

  <div class="yui3-u-1-2">
    <%= f.input :reference_unit %>
  </div>

  <div class="yui3-u-1-2">
    <%= f.input :manufacturer %>
  </div>

  <div class="yui3-u-1-2">
    <%= f.input :perishable %>
  </div>

  <div class="yui3-u-1-2">
    <%= f.input :storable %>
  </div>

  <div class="yui3-u-1-2">
    <%= f.input :material_characteristic %>
  </div>

  <div class="yui3-u-1-2">
    <%= f.input :service_or_contract_type, :disabled => !f.object.service? %>
  </div>

  <div class="yui3-u-1-2">
    <%= f.input :material_type, :disabled => !f.object.material? %>
  </div>

  <div class="yui3-u-1-2">
    <%= f.input :combustible %>
  </div>

  <div class="yui3-u-1-2">
    <%= f.input :stn_ordinance, :as => :modal, :hidden_field => :stn_ordinance_id %>
  </div>

  <div class="yui3-u-1-2">
    <%= f.input :economic_classification_of_expenditure, :disabled => f.object.stn_ordinance.blank? %>
  </div>
</div>

<script>
  var stn_ordinance_id = $('#material_stn_ordinance_id').val(),
      materials_group_id = $('#material_materials_group_id').val();

  $("#material_material_characteristic").change(function() {
    if (this.value == 'material') {
      $("#material_service_or_contract_type").attr('disabled', true);
      $("#material_material_type").attr('disabled', false);
    } else if (this.value == 'service') {
      $("#material_material_type").attr('disabled', true);
      $("#material_service_or_contract_type").attr('disabled', false);
    }
  });

  $('#material_materials_group_id').change(function() {
    if (this.value) {
      $('#material_materials_class').attr('disabled', false);
      $('#material_materials_class').attr('data-modal-url', materialsClassModalUrl);
    } else {
      $('#material_materials_class').attr('disabled', true);
    }

    clearMaterialsClass();
  }).change();

  $('#material_stn_ordinance_id').change(function() {
    if (this.value) {
      $('#material_economic_classification_of_expenditure').attr('disabled', false);
      $('#material_economic_classification_of_expenditure').attr('data-modal-url', economicClassificationOfExpenditureModalUrl);
    } else {
      $('#material_economic_classification_of_expenditure').attr('disabled', true);
    }

    clearEconomicClassificationOfExpenditure();
  }).change();

  function clearMaterialsClass() {
    if ($('#material_materials_group_id').val() != materials_group_id) {
      materials_group_id = $('#material_materials_group_id').val();

      $('#material_materials_class').val('');
      $('#material_materials_class_id').val('');
    }
  }

  function clearEconomicClassificationOfExpenditure() {
    if ($('#material_stn_ordinance_id').val() != stn_ordinance_id) {
      stn_ordinance_id = $('#material_stn_ordinance_id').val();

      $('#material_economic_classification_of_expenditure').val('');
      $('#material_economic_classification_of_expenditure_id').val('');
    }
  }

  function materialsClassModalUrl() {
    var url = "<%= modal_materials_classes_path %>?",
        params = {
          locked_fields: ["materials_group"],
          materials_class: {
            materials_group_id: $('#material_materials_group_id').val()
          }
        };

    url += jQuery.param(params);

    return url;
  }

  function economicClassificationOfExpenditureModalUrl() {
    var url = "<%= modal_economic_classification_of_expenditures_path %>?",
        params = {
          locked_fields: ["stn_ordinance"],
          economic_classification_of_expenditure: {
            stn_ordinance_id: $('#material_stn_ordinance_id').val()
          }
        };

    url += jQuery.param(params);

    return url;
  }
</script>
